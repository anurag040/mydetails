<div class="statistics-dashboard" *ngIf="currentDataset">
  <!-- Header Section -->
  <div class="header-content">
    <div class="header-icon">
      <mat-icon>analytics</mat-icon>
    </div>
    <div class="header-text">
      <h1 class="header-title">Statistical Analysis Dashboard</h1>
      <p class="header-subtitle">{{ currentDataset.filename }} • {{ currentDataset.rows }} rows × {{ currentDataset.columns }} columns</p>
    </div>
  </div>
  
  <div class="dataset-stats" *ngIf="quickSummary">
    <div class="stat-chip">
      <span class="stat-value">{{ quickSummary.shape?.rows | number }}</span>
      <span class="stat-label">Rows</span>
    </div>
    <div class="stat-chip">
      <span class="stat-value">{{ quickSummary.shape?.columns | number }}</span>
      <span class="stat-label">Columns</span>
    </div>
    <div class="stat-chip warning" *ngIf="quickSummary.missing_data?.percentage > 0">
      <span class="stat-value">{{ quickSummary.missing_data?.percentage | number:'1.1-1' }}%</span>
      <span class="stat-label">Missing</span>
    </div>
    <div class="stat-chip">
      <span class="stat-value">{{ quickSummary.memory_usage }}</span>
      <span class="stat-label">Memory</span>
    </div>
  </div>

  <!-- Selection Controls -->
  <div class="selection-controls">
    <div class="control-buttons">
      <button mat-stroked-button (click)="selectAllOptions()" class="control-button">
        <mat-icon>select_all</mat-icon>
        Select All
      </button>
      <button mat-stroked-button (click)="unselectAllOptions()" class="control-button">
        <mat-icon>deselect</mat-icon>
        Unselect All
      </button>
    </div>
    <div class="selection-info">
      <span class="selected-count">{{ getSelectedCount() }}</span> / {{ basicOptions.length }} options selected
    </div>
  </div>

  <!-- Analysis Options Grid -->
  <div class="analysis-options-grid">
    <div *ngFor="let option of basicOptions" class="option-card" [class.selected]="option.selected">
      <mat-checkbox [(ngModel)]="option.selected" class="option-checkbox">
        <div class="option-content">
          <div class="option-icon">
            <mat-icon>{{ getOptionIcon(option.name) }}</mat-icon>
          </div>
          <div class="text-content">
            <h3 class="option-title">{{ option.name }}</h3>
            <p class="option-description">{{ option.description }}</p>
          </div>
        </div>
      </mat-checkbox>
    </div>
  </div>

  <div class="launch-section">
    <button mat-raised-button class="launch-button" (click)="calculateBasicStatistics()" [disabled]="isLoading">
      <mat-icon>rocket_launch</mat-icon>
      Launch Analysis
    </button>
    <mat-spinner *ngIf="isLoading" diameter="24" class="loading-spinner"></mat-spinner>
  </div>

  <!-- Results Section -->
  <div *ngIf="basicResults" class="results-section">
    <div class="section-header">
      <div class="section-title">
        <mat-icon>insights</mat-icon>
        <h2>Analysis Results</h2>
      </div>
      <p class="section-description">Comprehensive statistical analysis of your dataset</p>
    </div>

    <!-- Basic Statistics -->
    <div *ngIf="basicResults.descriptive_stats" class="descriptive-stats-section">
      <div class="section-header">
        <mat-icon>analytics</mat-icon>
        <h3>Descriptive Statistics</h3>
      </div>
      
      <!-- AI Summary Section -->
      <div *ngIf="basicResults.descriptive_stats.ai_summary" class="ai-summary-section">
        <div class="ai-summary-header">
          <mat-icon>psychology</mat-icon>
          <h4>AI Insights</h4>
        </div>
        
        <div [ngSwitch]="basicResults.descriptive_stats.ai_summary.status" class="ai-content">
          <div *ngSwitchCase="'success'" class="ai-success">
            <div class="ai-summary-text">
              <mat-icon>insights</mat-icon>
              <p>{{ basicResults.descriptive_stats.ai_summary.summary }}</p>
            </div>
            
            <!-- Enhanced Confidence Indicator -->
            <app-confidence-indicator 
              *ngIf="getConfidenceData(basicResults.descriptive_stats.ai_summary)"
              [confidence]="getConfidenceData(basicResults.descriptive_stats.ai_summary)"
              [showDetails]="true"
              [compact]="false">
            </app-confidence-indicator>
          </div>
          
          <div *ngSwitchCase="'unavailable'" class="ai-unavailable">
            <mat-icon>cloud_off</mat-icon>
            <p>{{ basicResults.descriptive_stats.ai_summary.message }}</p>
          </div>
          
          <div *ngSwitchCase="'error'" class="ai-error">
            <mat-icon>error_outline</mat-icon>
            <p>{{ basicResults.descriptive_stats.ai_summary.message }}</p>
          </div>
        </div>
      </div>
      
      <div class="stats-grid">
        <div *ngFor="let column of getDescriptiveStatsKeys()" class="stats-column">
          <h4>{{ column }}</h4>
          <div class="stat-item">
            <span class="label">Count</span>
            <span class="value">{{ formatNumber(getDescriptiveStatsData()[column]?.count) }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Mean</span>
            <span class="value">{{ formatNumber(getDescriptiveStatsData()[column]?.mean) }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Std</span>
            <span class="value">{{ formatNumber(getDescriptiveStatsData()[column]?.std) }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Min</span>
            <span class="value">{{ formatNumber(getDescriptiveStatsData()[column]?.min) }}</span>
          </div>
          <div class="stat-item">
            <span class="label">25%</span>
            <span class="value">{{ formatNumber(getDescriptiveStatsData()[column]?.['25%']) }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Median</span>
            <span class="value">{{ formatNumber(getDescriptiveStatsData()[column]?.['50%']) }}</span>
          </div>
          <div class="stat-item">
            <span class="label">75%</span>
            <span class="value">{{ formatNumber(getDescriptiveStatsData()[column]?.['75%']) }}</span>
          </div>
          <div class="stat-item">
            <span class="label">Max</span>
            <span class="value">{{ formatNumber(getDescriptiveStatsData()[column]?.max) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Correlation Analysis -->
    <div *ngIf="basicResults.correlation_matrix && isAnalysisSelected('correlation')" class="correlation-section">
      <div class="section-header">
        <mat-icon>device_hub</mat-icon>
        <h3>Correlation Analysis</h3>
      </div>
      
      <!-- AI Summary for Correlations -->
      <div *ngIf="basicResults.correlation_matrix.ai_summary" class="ai-summary-section">
        <!-- <div class="ai-summary-header">
          <mat-icon>psychology</mat-icon>
          <h4>AI Insights</h4>
        </div> -->
        
        <div *ngIf="basicResults.correlation_matrix.ai_summary.status === 'success'" class="ai-content">
          <div class="ai-success">
            <div class="ai-summary-text">
              <mat-icon>insights</mat-icon>
              <p>{{ basicResults.correlation_matrix.ai_summary.summary }}</p>
            </div>
            
            <!-- Enhanced Confidence Indicator -->
            <app-confidence-indicator 
              *ngIf="getConfidenceData(basicResults.correlation_matrix.ai_summary)"
              [confidence]="getConfidenceData(basicResults.correlation_matrix.ai_summary)"
              [showDetails]="true"
              [compact]="false">
            </app-confidence-indicator>
          </div>
        </div>
        
        <div *ngIf="basicResults.correlation_matrix.ai_summary.status !== 'success'" class="ai-content">
          <div class="ai-unavailable">
            <mat-icon>cloud_off</mat-icon>
            <p>{{ basicResults.correlation_matrix.ai_summary.message || 'AI insights unavailable' }}</p>
          </div>
        </div>
      </div>

      <!-- Correlation Summary Stats -->
      <div *ngIf="basicResults.correlation_matrix.correlation_summary" class="correlation-summary-stats">
        <div class="stats-row">
          <div class="stat-metric">
            <mat-icon class="metric-icon">analytics</mat-icon>
            <span class="metric-value">{{ basicResults.correlation_matrix.correlation_summary.total_pairs }}</span>
            <span class="metric-label">Total Pairs</span>
          </div>
          
          <div class="stat-metric highlight">
            <mat-icon class="metric-icon">link</mat-icon>
            <span class="metric-value">{{ basicResults.correlation_matrix.correlation_summary.strong_correlations_count }}</span>
            <span class="metric-label">Strong Correlations</span>
          </div>
          
          <div class="stat-metric">
            <mat-icon class="metric-icon">trending_up</mat-icon>
            <span class="metric-value">{{ formatNumber(basicResults.correlation_matrix.correlation_summary.average_correlation) }}</span>
            <span class="metric-label">Avg Correlation</span>
          </div>
          
          <div class="stat-metric" [class.warning]="basicResults.correlation_matrix.correlation_summary.max_correlation > 0.9">
            <mat-icon class="metric-icon">priority_high</mat-icon>
            <span class="metric-value">{{ formatNumber(basicResults.correlation_matrix.correlation_summary.max_correlation) }}</span>
            <span class="metric-label">Max Correlation</span>
          </div>
        </div>
      </div>

      <!-- Key Insights -->
      <div *ngIf="basicResults.correlation_matrix.correlation_insights?.length" class="correlation-insights">
        <h4><mat-icon>lightbulb</mat-icon> Key Insights</h4>
        <div class="insights-grid">
          <div *ngFor="let insight of basicResults.correlation_matrix.correlation_insights" 
               class="insight-card" [ngClass]="insight.type">
            <div class="insight-header">
              <mat-icon>{{ getInsightIcon(insight.type) }}</mat-icon>
              <span class="insight-message">{{ insight.message }}</span>
            </div>
            <p class="insight-recommendation">{{ insight.recommendation }}</p>
          </div>
        </div>
      </div>

      <!-- Strong Correlations List -->
      <div *ngIf="getCorrelationPairs().length > 0" class="correlations-list">
        <h4><mat-icon>link</mat-icon> Strong Correlations (|r| ≥ 0.7)</h4>
        <div class="correlation-grid">
          <div *ngFor="let pair of getCorrelationPairs()" class="correlation-item">
            <div class="correlation-pair">
              <strong>{{ pair.var1 }}</strong>
              <mat-icon [ngClass]="pair.direction">{{ pair.direction === 'positive' ? 'trending_up' : 'trending_down' }}</mat-icon>
              <strong>{{ pair.var2 }}</strong>
            </div>
            <div class="correlation-value" [ngClass]="pair.direction">
              {{ formatNumber(pair.correlation) }}
            </div>
            <div class="correlation-strength">{{ pair.strength }}</div>
            <div class="correlation-interpretation">{{ pair.interpretation }}</div>
          </div>
        </div>
      </div>
      
      <!-- No Strong Correlations Message -->
      <div *ngIf="getCorrelationPairs().length === 0" class="no-correlations">
        <mat-icon>info</mat-icon>
        <p>No strong correlations found (all correlations < 0.7)</p>
        <small>This suggests your variables are relatively independent, which is good for modeling.</small>
      </div>

      <!-- Correlation Heatmap -->
      <div *ngIf="correlationHeatmapChart" class="heatmap-section">
        <h4>Correlation Heatmap</h4>
        <div class="heatmap-container" style="height: 500px; width: 100%; min-height: 500px;">
          <canvas baseChart
                  [data]="correlationHeatmapChart"
                  [options]="heatmapChartOptions"
                  [type]="'scatter'">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Distribution Analysis -->
    <div *ngIf="basicResults.distribution_analysis" class="distribution-section">
      <div class="section-header">
        <mat-icon>show_chart</mat-icon>
        <h3>Distribution Analysis</h3>
      </div>
      
      <!-- Debug Info -->
      <div style="background: #f0f0f0; padding: 10px; margin-bottom: 15px; font-size: 12px;">
        <strong>Distribution Debug:</strong>
        Numeric Columns: {{ getNumericColumns().length }}, 
        Histograms Available: {{ !!basicResults.distribution_analysis?.histograms }}, 
        Distribution Charts: {{ distributionCharts.size }}
      </div>
      
      <div class="distribution-grid">
        <div *ngFor="let column of getNumericColumns()" class="distribution-item">
          <div class="distribution-header">
            <h4>{{ column }}</h4>
            <div class="distribution-shape">{{ getDistributionShape(column) }}</div>
          </div>
          
          <!-- Debug for individual chart -->
          <div style="background: #e8f5e8; padding: 5px; margin: 5px 0; font-size: 11px;">
            Chart Data Available: {{ !!getChartData(column) }}
          </div>
          
          <div *ngIf="getChartData(column)" class="chart-container">
            <canvas baseChart
                    [data]="getChartData(column)!"
                    [options]="chartOptions"
                    [type]="'bar'">
            </canvas>
          </div>
          <div class="distribution-stats">
            <div class="stat-row">
              <span>Skewness:</span>
              <span class="stat-value">{{ formatNumber(basicResults.distribution_analysis.histograms?.[column]?.skewness || getSkewnessFromStats(column)) }}</span>
              <span class="stat-interpretation">{{ getSkewnessInterpretation(basicResults.distribution_analysis.histograms?.[column]?.skewness || getSkewnessFromStats(column)) }}</span>
            </div>
            <div class="stat-row">
              <span>Kurtosis:</span>
              <span class="stat-value">{{ formatNumber(basicResults.distribution_analysis.histograms?.[column]?.kurtosis || getKurtosisFromStats(column)) }}</span>
              <span class="stat-interpretation">{{ getKurtosisInterpretation(basicResults.distribution_analysis.histograms?.[column]?.kurtosis || getKurtosisFromStats(column)) }}</span>
            </div>
          </div>
        </div>
      </div>
      
    </div>

    <!-- Additional Analysis Results -->
    <div class="additional-results">
      <!-- Missing Data Summary -->
      <div *ngIf="basicResults.missing_data_summary" class="result-item">
        <div class="item-header">
          <mat-icon>help_outline</mat-icon>
          <h4>Missing Data Analysis</h4>
        </div>
        <div class="quick-stat">
          <span class="value">{{ basicResults.missing_data_summary.complete_rows | number }}</span>
          <span class="label">Complete Rows ({{ basicResults.missing_data_summary.complete_rows_percentage | number:'1.1-1' }}%)</span>
        </div>
        <div class="quick-stat warning">
          <span class="value">{{ basicResults.missing_data_summary.total_missing | number }}</span>
          <span class="label">Missing Values ({{ basicResults.missing_data_summary.total_percentage | number:'1.1-1' }}%)</span>
        </div>
        
      </div>

      <!-- Outlier Detection -->
      <div *ngIf="basicResults.outlier_detection" class="result-item">
        <div class="item-header">
          <mat-icon>scatter_plot</mat-icon>
          <h4>Outlier Detection</h4>
        </div>
        <div class="quick-stat">
          <span class="value">{{ basicResults.outlier_detection.summary?.total_outlier_count | number }}</span>
          <span class="label">Total Outliers ({{ basicResults.outlier_detection.summary?.outlier_percentage | number:'1.2-2' }}%)</span>
        </div>
        <div class="quick-stat">
          <span class="value">{{ basicResults.outlier_detection.summary?.columns_with_outliers | number }}</span>
          <span class="label">Affected Columns</span>
        </div>
      </div>

      <!-- Enhanced Data Quality Assessment -->
      <div *ngIf="basicResults.type_integrity_validation" class="result-item">
        <div class="item-header">
          <mat-icon>verified</mat-icon>
          <h4>Data Quality Assessment</h4>
        </div>
        <div class="quality-score">
          <div class="score-circle" 
               [attr.data-score]="basicResults.type_integrity_validation.overall_quality_score"
               [ngClass]="getQualityScoreClass(basicResults.type_integrity_validation.overall_quality_score)">
            <span class="score-value">{{ basicResults.type_integrity_validation.overall_quality_score | number:'1.0-0' }}%</span>
          </div>
          <div class="quality-details">
            <div class="quality-item">
              <span>{{ basicResults.type_integrity_validation.summary?.columns_analyzed || 0 }}</span>
              <small>Columns Analyzed</small>
            </div>
            <div class="quality-item" [ngClass]="getQualityGradeClass(basicResults.type_integrity_validation.quality_grade?.grade)">
              <span>{{ basicResults.type_integrity_validation.quality_grade?.grade || 'N/A' }}</span>
              <small>Quality Grade</small>
            </div>
            <div class="quality-item warning" *ngIf="basicResults.type_integrity_validation.summary?.critical_issues > 0">
              <span>{{ basicResults.type_integrity_validation.summary?.critical_issues }}</span>
              <small>Critical Issues</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Data Quality Section -->
    <div *ngIf="basicResults.type_integrity_validation" class="data-quality-section">
      <div class="section-header">
        <mat-icon>assessment</mat-icon>
        <h3>Comprehensive Data Quality Analysis</h3>
      </div>
      
      <!-- AI Quality Insights -->
      <div *ngIf="basicResults.type_integrity_validation.ai_insights" class="ai-summary-section">
        <div class="ai-summary-header">
          <mat-icon>psychology</mat-icon>
          <h4>AI Quality Insights</h4>
          <div class="confidence-badge" 
               *ngIf="basicResults.type_integrity_validation.ai_insights.confidence"
               [matTooltip]="getConfidenceTooltip(basicResults.type_integrity_validation.ai_insights.confidence)"
               matTooltipPosition="below">
            <mat-icon>verified</mat-icon>
            <span>{{ (basicResults.type_integrity_validation.ai_insights.confidence.score * 100).toFixed(0) }}% Confidence</span>
          </div>
        </div>
        <div [ngSwitch]="basicResults.type_integrity_validation.ai_insights.status" class="ai-content">
          <div *ngSwitchCase="'success'" class="ai-success">
            <div class="ai-summary-text">
              <mat-icon>insights</mat-icon>
              <p>{{ basicResults.type_integrity_validation.ai_insights.summary }}</p>
            </div>
          </div>
          <div *ngSwitchDefault class="ai-unavailable">
            <mat-icon>cloud_off</mat-icon>
            <p>{{ basicResults.type_integrity_validation.ai_insights.message || 'AI insights unavailable' }}</p>
          </div>
        </div>
      </div>



      <!-- Quality Metrics Dashboard -->
      <div class="quality-metrics-dashboard">
        <h4><mat-icon>dashboard</mat-icon> Quality Dimensions</h4>
        <div class="metrics-grid">
          <div *ngFor="let metric of getQualityMetrics()" class="metric-card" [ngClass]="getMetricClass(metric.value)">
            <div class="metric-header">
              <mat-icon>{{ metric.icon }}</mat-icon>
              <span class="metric-name">{{ metric.name }}</span>
            </div>
            <div class="metric-value">{{ metric.value }}%</div>
            <div class="metric-description">{{ metric.description }}</div>
            <div class="metric-bar">
              <div class="metric-fill" [style.width.%]="metric.value" [ngClass]="getMetricClass(metric.value)"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Column Quality Overview -->
      <div class="column-quality-overview">
        <h4><mat-icon>view_column</mat-icon> Column Quality Breakdown</h4>
        <div class="columns-grid">
          <div *ngFor="let col of getColumnQualityData()" class="column-card">
            <div class="column-header">
              <span class="column-name">{{ col.name }}</span>
              <div class="quality-flags">
                <mat-icon *ngFor="let flag of col.flags" 
                         [ngClass]="flag.color"
                         [matTooltip]="flag.label">{{ flag.icon }}</mat-icon>
              </div>
            </div>
            <div class="column-score" [ngClass]="getQualityScoreClass(col.score)">
              {{ col.score }}%
            </div>
            <div class="column-issues" *ngIf="col.issues.length > 0">
              <div *ngFor="let issue of col.issues" class="issue-tag" [ngClass]="issue.severity">
                {{ issue.message }}
              </div>
            </div>
            <div class="column-metrics">
              <div class="mini-metric" *ngFor="let metric of col.metrics">
                <span class="mini-metric-label">{{ metric.label }}</span>
                <span class="mini-metric-value">{{ metric.value }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Plan -->
      <div *ngIf="basicResults.type_integrity_validation.action_plan?.length" class="action-plan">
        <h4><mat-icon>assignment_turned_in</mat-icon> Recommended Actions</h4>
        <div class="actions-list">
          <div *ngFor="let action of basicResults.type_integrity_validation.action_plan" 
               class="action-item" [ngClass]="'priority-' + action.priority">
            <div class="action-header">
              <mat-icon>{{ getActionIcon(action.priority) }}</mat-icon>
              <span class="action-column">{{ action.column }}</span>
              <span class="action-impact" [ngClass]="action.impact.toLowerCase()">{{ action.impact }} Impact</span>
            </div>
            <p class="action-description">{{ action.action }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Expanded Results -->
    <div class="expanded-results">
      <!-- Missing Value Analysis -->
      <div *ngIf="basicResults.missing_value_analysis" class="analysis-section">
        <div class="section-header">
          <mat-icon>assignment</mat-icon>
          <h3>Missing Value Analysis & Strategy</h3>
        </div>
        <div *ngIf="basicResults.missing_value_analysis.recommendations" class="recommendations-list">
          <h4>Recommendations:</h4>
          <ul>
            <li *ngFor="let rec of basicResults.missing_value_analysis.recommendations">{{ rec }}</li>
          </ul>
        </div>
      </div>

      <!-- Duplicates Analysis -->
      <div *ngIf="basicResults.duplicates_analysis" class="analysis-section">
        <div class="section-header">
          <mat-icon>content_copy</mat-icon>
          <h3>Duplicate Analysis</h3>
        </div>
        <div class="duplicate-summary">
          <div class="metric">
            <span class="metric-value">{{ basicResults.duplicates_analysis.summary?.data_quality_score | number:'1.1-1' }}%</span>
            <span class="metric-label">Data Quality Score</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ basicResults.duplicates_analysis.summary?.duplicate_rows | number }}</span>
            <span class="metric-label">Duplicate Rows</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ basicResults.duplicates_analysis.summary?.unique_rows | number }}</span>
            <span class="metric-label">Unique Rows</span>
          </div>
        </div>
        <div *ngIf="basicResults.duplicates_analysis.recommendations" class="recommendations-list">
          <h4>Recommendations:</h4>
          <ul>
            <li *ngFor="let rec of basicResults.duplicates_analysis.recommendations">{{ rec }}</li>
          </ul>
        </div>
      </div>

      <!-- Univariate Summaries -->
      <div *ngIf="basicResults.univariate_summaries" class="analysis-section univariate-section">
        <div class="section-header">
          <mat-icon>analytics</mat-icon>
          <h3>Comprehensive Univariate Analysis</h3>
        </div>
        
        <!-- Numeric Variables -->
        <div *ngIf="getNumericSummaryColumns().length > 0" class="variable-type-section">
          <h4><mat-icon>functions</mat-icon> Numeric Variables ({{ getNumericSummaryColumns().length }})</h4>
          <div class="variables-grid">
            <div *ngFor="let column of getNumericSummaryColumns()" class="variable-card numeric">
              <div class="variable-header">
                <span class="variable-name">{{ column }}</span>
                <div class="variable-type-badge numeric">Numeric</div>
              </div>
              
              <div class="variable-stats" 
                   *ngIf="getNumericSummaryData(column) as summary">
                <div class="stats-grid">
                  <div class="stat-item">
                    <span class="stat-label">Count</span>
                    <span class="stat-value">{{ summary.basic_stats?.count | number }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Mean</span>
                    <span class="stat-value">{{ summary.basic_stats?.mean | number:'1.2-2' }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Std Dev</span>
                    <span class="stat-value">{{ summary.basic_stats?.std | number:'1.2-2' }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Min</span>
                    <span class="stat-value">{{ summary.basic_stats?.min | number:'1.2-2' }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">25%</span>
                    <span class="stat-value">{{ summary.basic_stats?.q1 | number:'1.2-2' }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Median</span>
                    <span class="stat-value">{{ summary.basic_stats?.median | number:'1.2-2' }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">75%</span>
                    <span class="stat-value">{{ summary.basic_stats?.q3 | number:'1.2-2' }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Max</span>
                    <span class="stat-value">{{ summary.basic_stats?.max | number:'1.2-2' }}</span>
                  </div>
                </div>
                
                <!-- Distribution Info -->
                <div *ngIf="summary.distribution_stats" class="distribution-info">
                  <div class="distribution-metrics">
                    <div class="metric-row">
                      <span class="metric-name">Skewness:</span>
                      <span class="metric-value" [ngClass]="getSkewnessClass(summary.distribution_stats.skewness)">
                        {{ summary.distribution_stats.skewness | number:'1.3-3' }}
                      </span>
                    </div>
                    <div class="metric-row">
                      <span class="metric-name">Kurtosis:</span>
                      <span class="metric-value">{{ summary.distribution_stats.kurtosis | number:'1.3-3' }}</span>
                    </div>
                    <div class="metric-row" *ngIf="summary.distribution_stats.is_normal !== null">
                      <span class="metric-name">Normal:</span>
                      <span class="metric-value" [ngClass]="summary.distribution_stats.is_normal ? 'positive' : 'negative'">
                        {{ summary.distribution_stats.is_normal ? 'Yes' : 'No' }}
                      </span>
                    </div>
                  </div>
                </div>
                
                <!-- Outliers Info -->
                <div *ngIf="summary.outlier_info" class="outlier-info">
                  <div class="outlier-summary">
                    <mat-icon [ngClass]="summary.outlier_info.outlier_count > 0 ? 'warning' : 'success'">
                      {{ summary.outlier_info.outlier_count > 0 ? 'warning' : 'check_circle' }}
                    </mat-icon>
                    <span class="outlier-text">
                      {{ summary.outlier_info.outlier_count }} outliers 
                      ({{ summary.outlier_info.outlier_percentage | number:'1.1-1' }}%)
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Categorical Variables -->
        <div *ngIf="getCategoricalSummaryColumns().length > 0" class="variable-type-section">
          <h4><mat-icon>category</mat-icon> Categorical Variables ({{ getCategoricalSummaryColumns().length }})</h4>
          <div class="variables-grid">
            <div *ngFor="let column of getCategoricalSummaryColumns()" class="variable-card categorical">
              <div class="variable-header">
                <span class="variable-name">{{ column }}</span>
                <div class="variable-type-badge categorical">Categorical</div>
              </div>
              
              <div class="variable-stats" 
                   *ngIf="getCategoricalSummaryData(column) as summary">
                <div class="stats-grid">
                  <div class="stat-item">
                    <span class="stat-label">Count</span>
                    <span class="stat-value">{{ summary.basic_stats?.count | number }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Unique</span>
                    <span class="stat-value">{{ summary.basic_stats?.unique_count | number }}</span>
                  </div>
                  <div class="stat-item" *ngIf="summary.basic_stats?.mode">
                    <span class="stat-label">Most Frequent</span>
                    <span class="stat-value">{{ summary.basic_stats?.mode }}</span>
                  </div>
                  <div class="stat-item" *ngIf="summary.basic_stats?.mode_frequency">
                    <span class="stat-label">Frequency</span>
                    <span class="stat-value">{{ summary.basic_stats?.mode_frequency | number }}</span>
                  </div>
                </div>
                
                <!-- Category Distribution -->
                <div *ngIf="summary.top_categories && getTopCategoriesArray(summary.top_categories).length > 0" class="category-distribution">
                  <h5>Top Categories:</h5>
                  <div class="category-list">
                    <div *ngFor="let item of getTopCategoriesArray(summary.top_categories)" class="category-item">
                      <span class="category-name">{{ item.key }}</span>
                      <div class="category-bar">
                        <div class="category-fill" [style.width.%]="getCategoryBarWidth(item.value, summary.top_categories)"></div>
                        <span class="category-count">{{ item.value }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Temporal Variables -->
        <div *ngIf="getTemporalSummaryColumns().length > 0" class="variable-type-section">
          <h4><mat-icon>schedule</mat-icon> Temporal Variables ({{ getTemporalSummaryColumns().length }})</h4>
          <div class="variables-grid">
            <div *ngFor="let column of getTemporalSummaryColumns()" class="variable-card temporal">
              <div class="variable-header">
                <span class="variable-name">{{ column }}</span>
                <div class="variable-type-badge temporal">Temporal</div>
              </div>
              
              <div class="variable-stats" 
                   *ngIf="getTemporalSummaryData(column) as summary">
                <div class="stats-grid">
                  <div class="stat-item">
                    <span class="stat-label">Count</span>
                    <span class="stat-value">{{ summary.basic_stats?.count | number }}</span>
                  </div>
                  <div class="stat-item" *ngIf="summary.basic_stats?.min_date">
                    <span class="stat-label">First Date</span>
                    <span class="stat-value">{{ summary.basic_stats?.min_date | date:'short' }}</span>
                  </div>
                  <div class="stat-item" *ngIf="summary.basic_stats?.max_date">
                    <span class="stat-label">Last Date</span>
                    <span class="stat-value">{{ summary.basic_stats?.max_date | date:'short' }}</span>
                  </div>
                  <div class="stat-item" *ngIf="summary.basic_stats?.unique_count">
                    <span class="stat-label">Unique Values</span>
                    <span class="stat-value">{{ summary.basic_stats?.unique_count | number }}</span>
                  </div>
                </div>
                
                <!-- Temporal Patterns -->
                <div *ngIf="summary.temporal_patterns" class="temporal-patterns">
                  <h5>Patterns:</h5>
                  <div class="pattern-list">
                    <div *ngFor="let pattern of summary.temporal_patterns" class="pattern-item">
                      <mat-icon>insights</mat-icon>
                      <span>{{ pattern }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Comprehensive Feature Engineering Ideas -->
      <div *ngIf="basicResults.feature_engineering_ideas" class="analysis-section feature-engineering-section">
        <div class="section-header">
          <mat-icon>build_circle</mat-icon>
          <h3>Feature Engineering Suggestions</h3>
          <div class="section-subtitle">Generate new features to improve model performance</div>
        </div>

        <!-- Error Display -->
        <div *ngIf="basicResults.feature_engineering_ideas.error" class="error-display">
          <mat-icon>error</mat-icon>
          <p>{{ basicResults.feature_engineering_ideas.error }}</p>
        </div>

        <!-- Transformation Ideas -->
        <div *ngIf="basicResults.feature_engineering_ideas.transformation_ideas?.length > 0" class="feature-category">
          <div class="category-header">
            <mat-icon>transform</mat-icon>
            <h4>Data Transformations</h4>
            <span class="count-badge">{{ basicResults.feature_engineering_ideas.transformation_ideas.length }}</span>
          </div>
          <div class="ideas-grid">
            <div *ngFor="let idea of basicResults.feature_engineering_ideas.transformation_ideas" 
                 class="idea-card" [ngClass]="'priority-' + idea.priority">
              <div class="idea-header">
                <span class="column-name">{{ idea.column }}</span>
                <span class="priority-badge" [ngClass]="idea.priority">{{ idea.priority }}</span>
              </div>
              <div class="issue-description">
                <mat-icon>warning</mat-icon>
                <span>{{ idea.issue }}</span>
              </div>
              <div class="suggestions">
                <div class="suggestion-tag" *ngFor="let suggestion of idea.suggestions">
                  {{ suggestion }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Interaction Features -->
        <div *ngIf="basicResults.feature_engineering_ideas.interaction_features?.length > 0" class="feature-category">
          <div class="category-header">
            <mat-icon>merge_type</mat-icon>
            <h4>Feature Interactions</h4>
            <span class="count-badge">{{ basicResults.feature_engineering_ideas.interaction_features.length }}</span>
          </div>
          <div class="ideas-grid">
            <div *ngFor="let interaction of basicResults.feature_engineering_ideas.interaction_features" 
                 class="idea-card interaction-card" [ngClass]="'priority-' + interaction.priority">
              <div class="interaction-header">
                <span class="feature-pair">{{ interaction.feature_1 }} × {{ interaction.feature_2 }}</span>
                <span class="correlation-badge" [ngClass]="getCorrelationClass(interaction.correlation)">
                  r = {{ interaction.correlation | number:'1.2-2' }}
                </span>
              </div>
              <div class="operations">
                <div class="operation-tag" *ngFor="let op of interaction.suggested_operations">
                  {{ op }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Encoding Suggestions -->
        <div *ngIf="basicResults.feature_engineering_ideas.encoding_suggestions?.length > 0" class="feature-category">
          <div class="category-header">
            <mat-icon>code</mat-icon>
            <h4>Categorical Encoding</h4>
            <span class="count-badge">{{ basicResults.feature_engineering_ideas.encoding_suggestions.length }}</span>
          </div>
          <div class="ideas-grid">
            <div *ngFor="let encoding of basicResults.feature_engineering_ideas.encoding_suggestions" 
                 class="idea-card encoding-card" [ngClass]="'priority-' + encoding.priority">
              <div class="encoding-header">
                <span class="column-name">{{ encoding.column }}</span>
                <span class="unique-count">{{ encoding.unique_values }} unique values</span>
              </div>
              <div class="encoding-suggestion">
                <mat-icon>label</mat-icon>
                <span>{{ encoding.suggested_encoding }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Temporal Features -->
        <div *ngIf="basicResults.feature_engineering_ideas.temporal_features?.length > 0" class="feature-category">
          <div class="category-header">
            <mat-icon>schedule</mat-icon>
            <h4>Temporal Features</h4>
            <span class="count-badge">{{ basicResults.feature_engineering_ideas.temporal_features.length }}</span>
          </div>
          <div class="ideas-grid">
            <div *ngFor="let temporal of basicResults.feature_engineering_ideas.temporal_features" 
                 class="idea-card temporal-card">
              <div class="temporal-header">
                <span class="column-name">{{ temporal.column }}</span>
                <span class="seasonality-note">{{ temporal.seasonality_check }}</span>
              </div>
              <div class="temporal-features">
                <div class="feature-tag" *ngFor="let feature of temporal.suggested_features">
                  {{ feature }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scaling Recommendations -->
        <div *ngIf="basicResults.feature_engineering_ideas.scaling_recommendations?.length > 0" class="feature-category">
          <div class="category-header">
            <mat-icon>straighten</mat-icon>
            <h4>Feature Scaling</h4>
            <span class="count-badge">{{ basicResults.feature_engineering_ideas.scaling_recommendations.length }}</span>
          </div>
          <div class="scaling-recommendations">
            <div *ngFor="let scaling of basicResults.feature_engineering_ideas.scaling_recommendations" 
                 class="scaling-card" [ngClass]="'priority-' + scaling.priority">
              <div class="scaling-issue">
                <mat-icon>warning</mat-icon>
                <span>{{ scaling.issue }}</span>
              </div>
              <div class="scaling-suggestion">
                <mat-icon>auto_fix_high</mat-icon>
                <span>{{ scaling.suggestion }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- No Suggestions Fallback -->
        <div *ngIf="!hasFeatureEngineeringSuggestions()" class="no-suggestions">
          <mat-icon>lightbulb_outline</mat-icon>
          <h4>No Specific Suggestions</h4>
          <p>Your dataset appears to be well-structured. Consider general techniques like:</p>
          <ul>
            <li>Creating polynomial features for non-linear relationships</li>
            <li>Domain-specific feature creation based on business knowledge</li>
            <li>Principal Component Analysis for dimensionality reduction</li>
          </ul>
        </div>
      </div>


      <!-- Dimensionality Insights -->
      <div *ngIf="basicResults.dimensionality_insights" class="analysis-section dimensionality-section">
        <div class="section-header">
          <mat-icon>scatter_plot</mat-icon>
          <h3>Dimensionality Insights</h3>
        </div>

        <!-- Dimensionality Summary Dashboard -->
        <div class="dimensionality-summary-dashboard">
          <div class="summary-row">
            <div class="summary-stat">
              <div class="stat-number">{{ basicResults.dimensionality_insights.overview?.total_features || basicResults.dimensionality_insights.pca_analysis?.total_components || 0 }}</div>
              <div class="stat-label">Original Features</div>
            </div>
            
            <div class="summary-stat" *ngIf="basicResults.dimensionality_insights.pca_analysis?.components_for_95_variance">
              <div class="stat-number">{{ basicResults.dimensionality_insights.pca_analysis.components_for_95_variance }}</div>
              <div class="stat-label">Components (95% Variance)</div>
            </div>
            
            <div class="summary-stat" *ngIf="basicResults.dimensionality_insights.clustering_analysis?.optimal_clusters">
              <div class="stat-number">{{ basicResults.dimensionality_insights.clustering_analysis.optimal_clusters }}</div>
              <div class="stat-label">Optimal Clusters</div>
            </div>
            
            <div class="summary-stat">
              <div class="stat-number complexity-{{ basicResults.dimensionality_insights.overview?.data_complexity }}">
                {{ (basicResults.dimensionality_insights.overview?.data_complexity || 'Unknown') | titlecase }}
              </div>
              <div class="stat-label">Data Complexity</div>
            </div>
          </div>

          <div class="quality-indicators" *ngIf="getPCAQualityScore() > 0 || getEffectiveRank() > 0">
            <div class="quality-item" *ngIf="getPCAQualityScore() > 0">
              <div class="quality-bar">
                <div class="quality-fill quality-{{ getPCAQualityClass() }}" [style.width.%]="getPCAQualityScore() * 100"></div>
              </div>
              <span class="quality-label">PCA Quality: {{ (getPCAQualityScore() * 100).toFixed(0) }}%</span>
            </div>
            
            <div class="quality-item" *ngIf="getEffectiveRank() > 0">
              <span class="quality-label">Effective Rank: {{ getEffectiveRank().toFixed(1) }}</span>
            </div>
          </div>
        </div>

        <!-- Intrinsic Dimensionality Analysis -->
        <div *ngIf="hasIntrinsicDimensionalityData()" class="intrinsic-dimensionality-section">
          <h4>
            <mat-icon>insights</mat-icon>
            Intrinsic Dimensionality Analysis
          </h4>
          
          <div class="intrinsic-metrics">
            <div class="metric-card">
              <div class="metric-header">
                <mat-icon>analytics</mat-icon>
                <span>Participation Ratio</span>
              </div>
              <div class="metric-value">{{ getIntrinsicDimensionality().participation_ratio?.toFixed(2) || 'N/A' }}</div>
              <div class="metric-description">Measure of effective dimensionality</div>
            </div>

            <div class="metric-card">
              <div class="metric-header">
                <mat-icon>compress</mat-icon>
                <span>90% Variance Dimensions</span>
              </div>
              <div class="metric-value">{{ getIntrinsicDimensionality().intrinsic_dim_90_variance || 'N/A' }}</div>
              <div class="metric-description">Components needed for 90% variance</div>
            </div>

            <div class="metric-card">
              <div class="metric-header">
                <mat-icon>psychology</mat-icon>
                <span>Complexity Assessment</span>
              </div>
              <div class="metric-value complexity-{{ getIntrinsicDimensionalityClass() }}">
                {{ getIntrinsicDimensionalityAssessment() }}
              </div>
              <div class="metric-description">Overall data complexity level</div>
            </div>
          </div>
        </div>

        <!-- Enhanced PCA Analysis Summary -->
        <div *ngIf="basicResults.dimensionality_insights.pca_analysis" class="pca-summary-section">
          <h4>
            <mat-icon>analytics</mat-icon>
            Enhanced Principal Component Analysis
          </h4>
          
          <!-- Primary PCA Metrics -->
          <div class="pca-primary-metrics">
            <div class="primary-metric-card">
              <div class="metric-icon">
                <mat-icon>insights</mat-icon>
              </div>
              <div class="metric-content">
                <div class="metric-value">{{ (basicResults.dimensionality_insights.pca_analysis.first_component_variance * 100).toFixed(1) }}%</div>
                <div class="metric-label">First Component Explains</div>
              </div>
            </div>

            <div class="primary-metric-card">
              <div class="metric-icon">
                <mat-icon>compress</mat-icon>
              </div>
              <div class="metric-content">
                <div class="metric-value potential-{{ getReductionPotentialClass(basicResults.dimensionality_insights.pca_analysis.dimensionality_reduction_potential) }}">
                  {{ (basicResults.dimensionality_insights.pca_analysis.dimensionality_reduction_potential || 'Unknown') | titlecase }}
                </div>
                <div class="metric-label">Reduction Potential</div>
              </div>
            </div>
          </div>

          <!-- Secondary PCA Metrics -->
          <div class="pca-secondary-metrics">
            <div class="secondary-metric" *ngIf="basicResults.dimensionality_insights.pca_analysis.components_for_90_variance">
              <span class="metric-label">90% Variance Components:</span>
              <span class="metric-value">{{ basicResults.dimensionality_insights.pca_analysis.components_for_90_variance }}</span>
            </div>

            <div class="secondary-metric" *ngIf="getKaiserCriterion() > 0">
              <span class="metric-label">Kaiser Criterion:</span>
              <span class="metric-value">{{ getKaiserCriterion() }} components</span>
            </div>

            <div class="secondary-metric" *ngIf="getScreeElbowPoint() > 0">
              <span class="metric-label">Scree Elbow Point:</span>
              <span class="metric-value">Component {{ getScreeElbowPoint() }}</span>
            </div>
          </div>

          <!-- Component Interpretations -->
          <div *ngIf="getComponentInterpretations().length > 0" class="component-interpretations">
            <h5>
              <mat-icon>psychology</mat-icon>
              Component Analysis
            </h5>
            <div class="components-summary">
              <div *ngFor="let component of getComponentInterpretations(); let i = index" class="component-summary-card">
                <div class="component-header">
                  <div class="component-name">{{ component.component }}</div>
                  <div class="component-variance">{{ component.variance_percentage?.toFixed(1) || 'N/A' }}%</div>
                </div>
                <div class="component-features" *ngIf="component.top_features">
                  <div class="feature-list">
                    <span *ngFor="let feature of component.top_features.slice(0, 3); let last = last" class="feature-tag">
                      {{ feature.feature }}<span *ngIf="!last">, </span>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Feature Importance Visualization -->
          <div *ngIf="getFeatureImportanceData().length > 0" class="feature-importance-section">
            <h5>
              <mat-icon>bar_chart</mat-icon>
              Feature Importance Across Components
            </h5>
            <div class="chart-container">
              <div style="height: 300px; background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e0e0e0;">
                <canvas baseChart
                        [data]="getFeatureImportanceChartData()"
                        [options]="featureImportanceOptions"
                        type="bar">
                </canvas>
              </div>
            </div>
          </div>

          <!-- Principal Components Analysis -->
          <div *ngIf="basicResults.dimensionality_insights.pca_analysis.component_features" class="principal-components-analysis">
            <h5>
              <mat-icon>scatter_plot</mat-icon>
              Principal Components Breakdown
            </h5>
            
            <div class="components-table">
              <div class="table-header">
                <div class="header-cell">Component</div>
                <div class="header-cell">Variance %</div>
                <div class="header-cell">Top Contributing Features</div>
              </div>
              
              <div *ngFor="let component of getTopComponents().slice(0, 4); let i = index" class="table-row">
                <div class="component-cell">
                  <div class="component-badge">{{ component.component }}</div>
                </div>
                
                <div class="variance-cell">
                  <div class="variance-bar">
                    <div class="variance-fill" [style.width.%]="component.variance_percentage"></div>
                  </div>
                  <span class="variance-text">{{ component.variance_percentage?.toFixed(1) || 'N/A' }}%</span>
                </div>
                
                <div class="features-cell">
                  <div class="feature-chips">
                    <span *ngFor="let feature of component.top_features?.slice(0, 3)" class="feature-chip">
                      {{ feature.feature }}
                      <small>({{ feature.contribution?.toFixed(2) || feature.loading?.toFixed(2) || 'N/A' }})</small>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- PCA Visualizations -->
          <div *ngIf="basicResults.dimensionality_insights.pca_analysis.component_variances" class="pca-visualizations">
            <h5>
              <mat-icon>bar_chart</mat-icon>
              PCA Component Analysis Charts
            </h5>
            
            <!-- Scree Plot -->
            <div class="chart-container">
              <h6>Scree Plot - Variance Explained by Components</h6>
              <div style="height: 300px; background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e0e0e0;">
                <canvas baseChart
                        [data]="getPCAScreePlotData()"
                        [options]="pcaScreePlotOptions"
                        type="line">
                </canvas>
              </div>
            </div>

            <!-- Feature Contribution Chart -->
            <div *ngIf="getTopComponents().length > 0" class="chart-container">
              <h6>Feature Contributions to Principal Components</h6>
              
              
              <div style="height: 300px; background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e0e0e0;">
                <canvas baseChart
                        [data]="getPCAFeatureContributionData()"
                        [options]="pcaFeatureContributionOptions"
                        type="bar">
                </canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Advanced Clustering Analysis -->
        <div *ngIf="hasAdvancedClusteringData()" class="advanced-clustering-section">
          <h4>
            <mat-icon>grain</mat-icon>
            Clustering Analysis Results
          </h4>
          
          <!-- Clustering Summary Cards -->
          <div class="clustering-summary-cards">
            <div class="clustering-card primary">
              <div class="card-header">
                <mat-icon>grain</mat-icon>
                <span>Optimal Clusters</span>
              </div>
              <div class="card-value">{{ getAdvancedClusteringData().optimal_clusters || 'N/A' }}</div>
              <div class="card-subtitle">{{ getBestClusteringMethod() | titlecase }} Method</div>
            </div>
            
            <div class="clustering-card">
              <div class="card-header">
                <mat-icon>assessment</mat-icon>
                <span>Quality Score</span>
              </div>
              <div class="card-value clustering-{{ getClusteringQualityClass() }}">
                {{ getAdvancedClusteringData().clustering_recommendation | titlecase }}
              </div>
              <div class="card-subtitle" *ngIf="getBestSilhouetteScore() > 0">
                Silhouette: {{ getBestSilhouetteScore().toFixed(3) }}
              </div>
            </div>
            
            <div class="clustering-card" *ngIf="getAdvancedClusteringData().cluster_stability">
              <div class="card-header">
                <mat-icon>trending_up</mat-icon>
                <span>Stability</span>
              </div>
              <div class="card-value">{{ (getAdvancedClusteringData().cluster_stability.stability_score * 100).toFixed(0) }}%</div>
              <div class="card-subtitle">Cluster Consistency</div>
            </div>
          </div>
          
          <!-- Available Methods -->
          <div class="clustering-methods-section" *ngIf="getClusteringMethods().length > 0">
            <h5>Available Clustering Methods</h5>
            <div class="methods-list">
              <span *ngFor="let method of getClusteringMethods()" class="method-tag">{{ method }}</span>
            </div>
          </div>

          <!-- Validation Metrics -->
          <div *ngIf="getClusterValidationMetrics().length > 0" class="validation-metrics">
            <h5>Cluster Validation Metrics</h5>
            <div class="metrics-grid">
              <div *ngFor="let metric of getClusterValidationMetrics()" class="validation-metric">
                <div class="metric-name">{{ metric.name }}</div>
                <div class="metric-value">{{ metric.value }}</div>
                <div class="metric-description">{{ metric.description }}</div>
              </div>
            </div>
          </div>

          <!-- Clustering Quality Radar Chart -->
          <div *ngIf="getClusterValidationMetrics().length > 0" class="clustering-radar">
            <h5>Clustering Quality Assessment</h5>
            <div class="chart-container">
              <div style="height: 300px; background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e0e0e0;">
                <canvas baseChart
                        [data]="getClusteringComparisonData()"
                        [options]="clusteringRadarOptions"
                        type="radar">
                </canvas>
              </div>
            </div>
          </div>

          <!-- Silhouette Analysis Visualization -->
          <div class="silhouette-analysis" *ngIf="getAdvancedClusteringData().silhouette_scores">
            <h5>
              <mat-icon>analytics</mat-icon>
              Silhouette Analysis by Cluster Count
            </h5>
            
            <!-- Chart Visualization -->
            <div class="silhouette-chart-container">
              <div class="chart-wrapper">
                <canvas baseChart
                        [data]="getSilhouetteChartData()"
                        [options]="silhouetteChartOptions"
                        type="bar">
                </canvas>
              </div>
            </div>
            
            <!-- Detailed Scores Table -->
            <div class="silhouette-scores-table">
              <div class="table-header">
                <div class="header-cell">Clusters</div>
                <div class="header-cell">Silhouette Score</div>
                <div class="header-cell">Quality Rating</div>
                <div class="header-cell">Visual</div>
              </div>
              
              <div *ngFor="let score of getAdvancedClusteringData().silhouette_scores; let i = index" 
                   class="score-row" [ngClass]="{'best-score': getBestSilhouetteScore() === score}">
                <div class="cluster-cell">
                  <div class="cluster-badge">{{ i + 2 }}</div>
                </div>
                
                <div class="score-cell">
                  <span class="score-value">{{ score.toFixed(3) }}</span>
                </div>
                
                <div class="quality-cell">
                  <div class="quality-visual">
                    <div class="quality-rating-number {{ getSilhouetteScoreClass(score) }}">
                      {{ getSilhouetteRatingNumber(score) }}
                    </div>
                    <div class="quality-info">
                      <span class="quality-badge quality-{{ getSilhouetteScoreClass(score) }}">
                        {{ getSilhouetteQualityText(score) }}
                      </span>
                      <span class="quality-description">{{ getSilhouetteDescription(score) }}</span>
                    </div>
                  </div>
                </div>
                
                <div class="visual-cell">
                  <div class="score-bar">
                    <div class="score-fill {{ getSilhouetteScoreClass(score) }}" 
                         [style.width.%]="(score * 100)">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Best Score Highlight -->
            <div class="best-score-highlight" *ngIf="getBestSilhouetteScore() > 0">
              <mat-icon>star</mat-icon>
              <span>Optimal cluster count: <strong>{{ getBestSilhouetteClusterCount() }} clusters</strong> with score {{ getBestSilhouetteScore().toFixed(3) }}</span>
            </div>
          </div>
  <!-- Advanced Analysis Results -->
  <div *ngIf="advancedResults" class="advanced-results-container">
    <div class="section-header">
      <mat-icon>analytics</mat-icon>
      <h2>Advanced Analysis Results</h2>
    </div>

    <!-- PCA Analysis Results -->
    <div *ngIf="advancedResults.pca_analysis" class="analysis-section pca-analysis-section" data-analysis-type="pca_analysis">
      <div class="section-header">
        <mat-icon>scatter_plot</mat-icon>
        <h3>Principal Component Analysis (PCA)</h3>
      </div>
      
      <!-- PCA Summary Cards -->
      <div class="pca-summary-cards">
        <div class="summary-card">
          <div class="card-content">
            <mat-icon class="card-icon">insights</mat-icon>
            <div class="card-details">
              <span class="card-value">{{ advancedResults.pca_analysis.explained_variance_ratio?.length || 0 }}</span>
              <span class="card-label">Components</span>
            </div>
          </div>
        
        <div class="summary-card">
          <div class="card-content">
            <mat-icon class="card-icon">compress</mat-icon>
            <div class="card-details">
              <span class="card-value">{{ advancedResults.pca_analysis.n_components_95_variance || 'N/A' }}</span>
              <span class="card-label">Components for 95% Variance</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Explained Variance Chart -->
              <div class="domain-coverage">
                <div class="domain-item" *ngFor="let factor of getConfidenceFactors()">
      <div *ngIf="advancedResults.pca_analysis.explained_variance_ratio" class="variance-chart-section">
        <h4>
          <mat-icon>bar_chart</mat-icon>
          Explained Variance by Component
        </h4>
        <div class="variance-bars">
          <div *ngFor="let variance of advancedResults.pca_analysis.explained_variance_ratio; let i = index" 
               class="variance-bar-item">
            <div class="bar-label">PC{{ i + 1 }}</div>
            <div class="variance-bar">
              <div class="bar-fill" [style.width.%]="variance * 100"></div>
            </div>
            <div class="variance-value">{{ (variance * 100) | number:'1.1-1' }}%</div>
          </div>
        </div>
      </div>

      <!-- Cumulative Variance -->
      <div *ngIf="advancedResults.pca_analysis.cumulative_variance_ratio" class="cumulative-variance-section">
          <div class="detailed-metric-card">
        <h4>
          <mat-icon>trending_up</mat-icon>
          Cumulative Variance Explained
        </h4>
        <div class="cumulative-chart">
          <div *ngFor="let cumVar of advancedResults.pca_analysis.cumulative_variance_ratio; let i = index" 
               class="cumulative-point">
            <div class="point-marker" [style.left.%]="(i / (advancedResults.pca_analysis.cumulative_variance_ratio.length - 1)) * 100">
              <div class="point-dot" [ngClass]="getCumulativeVarianceClass(cumVar)"></div>
              <div class="point-label">{{ (cumVar * 100) | number:'1.0-0' }}%</div>
            </div>
          </div>
          <div class="chart-axis">
            <span class="axis-label start">PC1</span>
            <span class="axis-label end">PC{{ advancedResults.pca_analysis.cumulative_variance_ratio?.length || 0 }}</span>
          </div>
        </div>
      
      <!-- Feature Importance -->
      <div *ngIf="advancedResults.pca_analysis.feature_importance" class="feature-importance-section">
                  <span class="tier-score">80%</span>
                </div>
                <div class="tier-item moderate" [class.active]="getEfficiencyTier() === 'acceptable'">
                  <span class="tier-name">Acceptable</span>
                  <span class="tier-range">5.0-10.0s</span>
                  <span class="tier-score">60%</span>
                </div>
                <div class="tier-item poor" [class.active]="getEfficiencyTier() === 'poor'">
                  <span class="tier-name">Poor</span>
                  <span class="tier-range">&gt; 10.0s</span>
                  <span class="tier-score">30%</span>
                </div>
              </div>
            </div>
            
            <div class="performance-metrics">
              <div class="performance-item">
                <mat-icon>timer</mat-icon>
                <span>Response Time: {{ getResponseTime() }}s</span>
              </div>
              <div class="performance-item">
                <mat-icon>grade</mat-icon>
                <span>Tier: {{ getEfficiencyTier() | titlecase }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Applied Statistical Tests -->
        <div class="statistical-tests-comprehensive">
          <div class="tests-header">
            <mat-icon>calculate</mat-icon>
            <h4>Applied Statistical Tests & Validation Methods</h4>
          </div>
          
          <div class="tests-detailed-grid">
            <div class="test-card">
              <div class="test-header">
                <mat-icon>functions</mat-icon>
                <h5>Shapiro-Wilk Normality Test</h5>
              </div>
              <div class="test-formula">
                <strong>Hypothesis:</strong> H₀: data follows normal distribution (α = 0.05)
              </div>
              <div class="test-application">
                <p><strong>Application:</strong> Validates distribution assumptions for statistical inference</p>
                <p><strong>Interpretation:</strong> p &gt; 0.05 indicates normal distribution</p>
              </div>
            </div>
            
            <div class="test-card">
              <div class="test-header">
                <mat-icon>trending_up</mat-icon>
                <h5>Pearson Correlation Analysis</h5>
              </div>
              <div class="test-formula">
                <strong>Formula:</strong> r = Σ((xᵢ-x̄)(yᵢ-ȳ)) / √(Σ(xᵢ-x̄)²Σ(yᵢ-ȳ)²)
              </div>
              <div class="test-application">
                <p><strong>Application:</strong> Validates linear relationship claims in LLM analysis</p>
                <p><strong>Interpretation:</strong> |r| &gt; 0.7 indicates strong correlation</p>
              </div>
            </div>
            
            <div class="test-card">
              <div class="test-header">
                <mat-icon>show_chart</mat-icon>
                <h5>Fisher's Skewness Coefficient</h5>
              </div>
              <div class="test-formula">
                <strong>Formula:</strong> γ₁ = E[(X-μ)³]/σ³
              </div>
              <div class="test-application">
                <p><strong>Application:</strong> Quantifies distribution asymmetry for shape analysis</p>
                <p><strong>Interpretation:</strong> |γ₁| &lt; 0.5 indicates approximate symmetry</p>
              </div>
            </div>
            
            <div class="test-card">
              <div class="test-header">
                <mat-icon>scatter_plot</mat-icon>
                <h5>Z-Score Outlier Detection</h5>
              </div>
              <div class="test-formula">
                <strong>Formula:</strong> |z| = |(x-μ)/σ| &gt; 3
              </div>
              <div class="test-application">
                <p><strong>Application:</strong> Identifies extreme values for data quality assessment</p>
                <p><strong>Interpretation:</strong> |z| &gt; 3 indicates potential outlier</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Rating & Certification -->
        <div class="performance-certification">
          <div class="certification-header">
            <mat-icon>workspace_premium</mat-icon>
            <h4>Validation Certification</h4>
          </div>
          
          <div class="certification-content">
            <div class="certification-badge" [ngClass]="getOverallValidationClass()">
              <div class="badge-icon">
                <mat-icon>{{ getValidationStatusIcon() }}</mat-icon>
              </div>
              <div class="badge-content">
                <div class="badge-score">{{ getLLMOverallValidationScore() }}%</div>
                <div class="badge-rating">{{ getPerformanceRating() }}</div>
              </div>
            </div>
            
            <div class="certification-details">
              <h5>Validation Summary</h5>
              <p class="validation-explanation">{{ getValidationExplanation() }}</p>
              
              <div class="certification-metrics">
                <div class="cert-metric">
                  <span class="cert-label">Validation Timestamp:</span>
                  <span class="cert-value">{{ getValidationTimestamp() }}</span>
                </div>
                <div class="cert-metric">
                  <span class="cert-label">Framework Version:</span>
                  <span class="cert-value">Technical Validation Framework v1.0</span>
                </div>
                <div class="cert-metric">
                  <span class="cert-label">Compliance Standard:</span>
                  <span class="cert-value">Academic Research Methodology</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Methodology Transparency -->
        <div class="methodology-section">
          <div class="methodology-header">
            <mat-icon>science</mat-icon>
            <h4>Methodology Transparency</h4>
          </div>
          
          <div class="methodology-content">
            <div class="methodology-principles">
              <h5>Validation Principles</h5>
              <ul class="principles-list">
                <li><strong>Mathematical Rigor:</strong> All validations use established statistical methods</li>
                <li><strong>Reproducibility:</strong> Results can be independently verified using same data</li>
                <li><strong>Transparency:</strong> All formulas and weights are explicitly documented</li>
                <li><strong>Academic Standards:</strong> Methodology meets publication-quality requirements</li>
                <li><strong>Multi-dimensional Assessment:</strong> Four independent validation dimensions</li>
              </ul>
            </div>
            
            <div class="limitations-acknowledgment">
              <h5>Limitations & Considerations</h5>
              <ul class="limitations-list">
                <li>Validation accuracy depends on data quality and size</li>
                <li>Efficiency metrics may vary based on system performance</li>
                <li>Completeness scoring uses domain-specific keyword matching</li>
                <li>Consistency detection limited to predefined contradiction patterns</li>
              </ul>
  <!-- Advanced Analysis Results -->
  <div *ngIf="advancedResults" class="advanced-results-container">
    <div class="section-header">
      <mat-icon>analytics</mat-icon>
      <h2>Advanced Analysis Results</h2>
    </div>

    <!-- PCA Analysis Results -->
    <div *ngIf="advancedResults.pca_analysis" class="analysis-section pca-analysis-section" data-analysis-type="pca_analysis">
      <div class="section-header">
        <mat-icon>scatter_plot</mat-icon>
        <h3>Principal Component Analysis (PCA)</h3>
      </div>

      <!-- PCA Summary Cards -->
      <div class="pca-summary-cards">
        <div class="summary-card">
          <div class="card-content">
            <mat-icon class="card-icon">insights</mat-icon>
            <div class="card-details">
              <span class="card-value">{{ advancedResults.pca_analysis.explained_variance_ratio?.length || 0 }}</span>
              <span class="card-label">Components</span>
            </div>
          </div>
        </div>
        
        <div class="summary-card">
          <div class="card-content">
            <mat-icon class="card-icon">donut_large</mat-icon>
            <div class="card-details">
              <span class="card-value">{{ getPCAVarianceExplained() }}%</span>
              <span class="card-label">Variance Explained</span>
            </div>
          </div>
        </div>
        
        <div class="summary-card">
          <div class="card-content">
            <mat-icon class="card-icon">compress</mat-icon>
            <div class="card-details">
              <span class="card-value">{{ advancedResults.pca_analysis.n_components_95_variance || 'N/A' }}</span>
              <span class="card-label">Components for 95% Variance</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Explained Variance Chart -->
      <div *ngIf="advancedResults.pca_analysis.explained_variance_ratio" class="variance-chart-section">
        <h4>
          <mat-icon>bar_chart</mat-icon>
          Explained Variance by Component
        </h4>
        <div class="variance-bars">
          <div *ngFor="let variance of advancedResults.pca_analysis.explained_variance_ratio; let i = index" 
               class="variance-bar-item">
            <div class="bar-label">PC{{ i + 1 }}</div>
            <div class="bar-container">
              <div class="bar-fill" 
                   [style.width.%]="(variance * 100)"
                   [attr.data-value]="(variance * 100).toFixed(1) + '%'">
              </div>
            </div>
            <div class="bar-value">{{ (variance * 100).toFixed(1) }}%</div>
          </div>
        </div>
      </div>

      <!-- Cumulative Variance -->
      <div *ngIf="advancedResults.pca_analysis.cumulative_variance_ratio" class="cumulative-variance-section">
        <h4>
          <mat-icon>trending_up</mat-icon>
          Cumulative Variance Explained
        </h4>
        <div class="cumulative-chart">
          <div *ngFor="let cumVar of advancedResults.pca_analysis.cumulative_variance_ratio; let i = index" 
               class="cumulative-point">
            <div class="point-marker" [style.left.%]="(i / (advancedResults.pca_analysis.cumulative_variance_ratio.length - 1)) * 100">
              <div class="point-dot" [ngClass]="getCumulativeVarianceClass(cumVar)"></div>
              <div class="point-label">{{ (cumVar * 100).toFixed(0) }}%</div>
            </div>
          </div>
          <div class="chart-line"></div>
        </div>
      </div>

      <!-- Feature Importance -->
      <div *ngIf="advancedResults.pca_analysis.feature_importance" class="feature-importance-section">
        <h4>
          <mat-icon>importance_high</mat-icon>
          Feature Importance in Principal Components
        </h4>
        <div class="importance-grid">
          <div *ngFor="let item of getFeatureImportanceItems()" class="importance-item">
            <div class="feature-name">{{ item.feature }}</div>
            <div class="importance-bar">
              <div class="importance-fill" 
                   [style.width.%]="item.percentage"
                   [ngClass]="getImportanceClass(item.value)">
              </div>
            </div>
            <div class="importance-value">{{ item.value.toFixed(3) }}</div>
          </div>
        </div>
      </div>

      <!-- PCA Insights -->
      <div class="pca-insights">
        <h4>
          <mat-icon>lightbulb</mat-icon>
          PCA Insights & Recommendations
        </h4>
        <div class="insights-grid">
          <div class="insight-card" 
               [ngClass]="getPCARecommendationClass(advancedResults.pca_analysis.n_components_95_variance)">
            <mat-icon>compress</mat-icon>
            <h5>Dimensionality Reduction</h5>
            <p *ngIf="advancedResults.pca_analysis.n_components_95_variance">
              You can reduce from {{ getOriginalFeatureCount() }} to 
              {{ advancedResults.pca_analysis.n_components_95_variance }} dimensions 
              while retaining 95% of the variance.
            </p>
            <p *ngIf="!advancedResults.pca_analysis.n_components_95_variance">
              All components are needed to explain 95% of the variance.
            </p>
          </div>
          
          <div class="insight-card">
            <mat-icon>speed</mat-icon>
            <h5>Model Performance</h5>
            <p>
              Using {{ advancedResults.pca_analysis.n_components_95_variance || 'all' }} components 
              can improve model training speed while maintaining most of the information.
            </p>
          </div>
          
          <div class="insight-card">
            <mat-icon>visibility</mat-icon>
            <h5>Data Visualization</h5>
            <p>
              The first 2-3 components explain {{ getFirst3ComponentsVariance() }}% 
              of variance and can be used for effective data visualization.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Simple PCA Scree Plot Implementation -->
    <!-- Debug: Check conditions -->
    <div *ngIf="basicResults" style="background: yellow; padding: 10px; margin: 5px; font-size: 12px;">
      <strong>PCA Debug Info:</strong><br>
      basicResults exists: {{ !!basicResults }}<br>
      dimensionality_insights exists: {{ !!basicResults.dimensionality_insights }}<br>
      pca_analysis exists: {{ !!basicResults.dimensionality_insights?.pca_analysis }}<br>
      component_variances exists: {{ hasPCAVariances() }}<br>
      component_variances length: {{ getPCAVariancesLength() }}<br>
      hasPCAData(): {{ hasPCAData() }}<br>
      getPCAComponentCount(): {{ getPCAComponentCount() }}<br>
    </div>
    
    <!-- Test PCA section with simpler condition -->
    <div *ngIf="basicResults" class="analysis-section pca-analysis" style="background: white; padding: 20px; margin: 10px; border: 2px solid #00ff7f;">
      <div class="section-header" style="margin-bottom: 20px;">
        <mat-icon style="color: #00ff7f;">analytics</mat-icon>
        <h3 style="color: #00ff7f; display: inline-block; margin-left: 10px;">PCA Scree Plot Analysis (Test)</h3>
      </div>
      
      <!-- Show condition status -->
      <div style="background: #f0f0f0; padding: 10px; margin-bottom: 15px; font-size: 12px;">
        <strong>PCA Condition Status:</strong><br>
        hasPCAData(): {{ hasPCAData() }}<br>
        component_variances exists: {{ hasPCAVariances() }}<br>
        component_variances length: {{ getPCAVariancesLength() }}<br>
      </div>
      
      <!-- PCA Metrics Cards -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
          <div style="color: #666; font-size: 14px; margin-bottom: 5px;">Components</div>
          <div style="font-size: 24px; font-weight: bold; color: #00ff7f;">{{ getPCAComponentCount() }}</div>
        </div>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
          <div style="color: #666; font-size: 14px; margin-bottom: 5px;">First Component</div>
          <div style="font-size: 24px; font-weight: bold; color: #00ff7f;">{{ getPCAFirstComponentVariance().toFixed(1) }}%</div>
        </div>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
          <div style="color: #666; font-size: 14px; margin-bottom: 5px;">First Two Components</div>
          <div style="font-size: 24px; font-weight: bold; color: #00ff7f;">{{ getPCAFirstTwoComponentsVariance().toFixed(1) }}%</div>
        </div>
      </div>

      <!-- PCA Charts Container -->
      <div class="pca-charts">
        <!-- PCA Scree Plot Chart -->
        <div style="margin-bottom: 30px;">
          <h4 style="color: #333; margin-bottom: 15px;">
            <mat-icon>trending_down</mat-icon>
            Scree Plot - Variance Explained by Components
          </h4>
          <div style="height: 400px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <canvas baseChart
                    [data]="getPCAScreePlotData()"
                    [options]="pcaScreePlotOptions"
                    type="line">
            </canvas>
          </div>
        </div>

        <!-- PCA Feature Contribution Chart -->
        <div *ngIf="getPCAComponentFeatures().length > 0" style="margin-bottom: 30px;">
          <h4 style="color: #333; margin-bottom: 15px;">
            <mat-icon>bar_chart</mat-icon>
            Feature Contributions to Principal Components
          </h4>
          <div style="height: 400px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <canvas baseChart
                    [data]="getPCAFeatureContributionData()"
                    [options]="pcaFeatureContributionOptions"
                    type="bar">
            </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Regression Analysis Results (if any) -->
    <div *ngIf="advancedResults?.regression_analysis" class="analysis-section regression-analysis-section">
      <div class="section-header">
        <mat-icon>trending_up</mat-icon>
        <h3>Regression Analysis</h3>
      </div>
      <!-- Regression content would go here -->
    </div>
  </div>
</div>