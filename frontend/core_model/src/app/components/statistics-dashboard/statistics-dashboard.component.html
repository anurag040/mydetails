<div class="statistics-dashboard" *ngIf="currentDataset">
  <!-- Header Section -->
  <mat-card class="header-card">
    <mat-card-header>
      <mat-icon mat-card-avatar>analytics</mat-icon>
      <mat-card-title>Statistical Analysis</mat-card-title>
      <mat-card-subtitle>{{ currentDataset.filename }} • {{ currentDataset.rows }} rows × {{ currentDataset.columns }} columns</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="analysis-type-indicator" *ngIf="selectedAnalysisType">
        <mat-chip [color]="selectedAnalysisType === 'basic' ? 'primary' : 'accent'" selected>
          <mat-icon>{{ selectedAnalysisType === 'basic' ? 'analytics' : 'science' }}</mat-icon>
          {{ selectedAnalysisType === 'basic' ? 'Basic Analysis' : 'Advanced Analysis' }}
        </mat-chip>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- AI-Powered Quick Summary -->
  <mat-card class="summary-card" *ngIf="quickSummary">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>psychology</mat-icon>
        AI-Powered Dataset Insights
      </mat-card-title>
      <mat-card-subtitle>Intelligent analysis of your data characteristics</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="ai-insights-container">
        <div class="insight-card" *ngFor="let insight of getAIInsights()">
          <div class="insight-header">
            <mat-icon [ngClass]="'insight-icon-' + insight.color">{{ insight.icon }}</mat-icon>
            <h4 class="insight-title">{{ insight.title }}</h4>
          </div>
          <p class="insight-description">{{ insight.description }}</p>
        </div>
        
        <!-- Raw Data Toggle (for advanced users) -->
        <mat-expansion-panel class="raw-data-panel">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon>code</mat-icon>
              Technical Details
            </mat-panel-title>
            <mat-panel-description>
              View raw data metrics for advanced analysis
            </mat-panel-description>
          </mat-expansion-panel-header>
          
          <div class="summary-grid">
            <div class="summary-item" *ngFor="let item of getSummaryEntries()">
              <span class="summary-label">{{ formatKeyName(item.key) }}</span>
              <span class="summary-value">{{ formatSummaryValue(item.value) }}</span>
            </div>
          </div>
        </mat-expansion-panel>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Analysis Tabs -->
  <mat-tab-group>
    <!-- Basic Statistics Tab -->
    <mat-tab label="Basic Statistics">
      <div class="tab-content">
        <!-- Options Selection -->
        <mat-card class="options-card">
          <mat-card-header>
            <mat-card-title>Analysis Options</mat-card-title>
            <mat-card-subtitle>Select the statistical analyses to perform</mat-card-subtitle>
          </mat-card-header>
          
          <mat-card-content>
            <div class="options-grid">
              <mat-checkbox 
                *ngFor="let option of basicOptions" 
                [(ngModel)]="option.selected"
                class="option-checkbox">
                <div class="option-content">
                  <span class="option-name">{{ option.name }}</span>
                  <span class="option-description">{{ option.description }}</span>
                </div>
              </mat-checkbox>
            </div>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-raised-button 
                    color="primary" 
                    (click)="calculateBasicStatistics()"
                    [disabled]="isLoading">
              <mat-icon>calculate</mat-icon>
              Calculate Basic Statistics
            </button>
            
            <mat-spinner *ngIf="isLoading" diameter="24" class="inline-spinner"></mat-spinner>
          </mat-card-actions>
        </mat-card>

        <!-- Basic Results -->
        <div class="results-section" *ngIf="basicResults">
          <!-- Descriptive Statistics -->
          <mat-card *ngIf="basicResults.descriptive_stats" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>bar_chart</mat-icon>
                Descriptive Statistics & AI Insights
              </mat-card-title>
              <mat-card-subtitle>
                Statistical summary with intelligent analysis and business implications
              </mat-card-subtitle>
            </mat-card-header>
            
            <mat-card-content>
              <!-- AI-Driven Insights Section -->
              <div class="insights-section" *ngIf="getDescriptiveInsights().length > 0">
                <h3 class="insights-title">
                  <mat-icon>psychology</mat-icon>
                  AI-Powered Statistical Insights
                </h3>
                
                <div class="insights-grid">
                  <div *ngFor="let insight of getDescriptiveInsights()" class="insight-card">
                    <div class="insight-header">
                      <h4>{{ insight.column }}</h4>
                      <mat-icon>trending_up</mat-icon>
                    </div>
                    
                    <div class="insight-content">
                      <div class="insight-item">
                        <strong>Distribution:</strong>
                        <span [innerHTML]="insight.dataDistribution"></span>
                      </div>
                      
                      <div class="insight-item">
                        <strong>Variability:</strong>
                        <span [innerHTML]="insight.variability"></span>
                      </div>
                      
                      <div class="insight-item">
                        <strong>Data Quality:</strong>
                        <span [innerHTML]="insight.outlierRisk"></span>
                      </div>
                      
                      <div class="insight-item business-insight">
                        <strong>Business Impact:</strong>
                        <span [innerHTML]="insight.businessImplication"></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Technical Statistics Table -->
              <div class="technical-section">
                <h3 class="technical-title">
                  <mat-icon>analytics</mat-icon>
                  Technical Statistics
                </h3>
                
                <div class="table-container">
                  <table mat-table [dataSource]="getDescriptiveStatsKeys()" class="descriptive-table">
                    <ng-container matColumnDef="column">
                      <th mat-header-cell *matHeaderCellDef>Column</th>
                      <td mat-cell *matCellDef="let column">
                        <strong>{{ column }}</strong>
                      </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="count">
                      <th mat-header-cell *matHeaderCellDef>Count</th>
                      <td mat-cell *matCellDef="let column">{{ formatNumber(getDescriptiveStatsData()[column]?.count) }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="mean">
                      <th mat-header-cell *matHeaderCellDef>Mean</th>
                      <td mat-cell *matCellDef="let column">{{ formatNumber(getDescriptiveStatsData()[column]?.mean) }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="median">
                      <th mat-header-cell *matHeaderCellDef>Median</th>
                      <td mat-cell *matCellDef="let column">{{ formatNumber(getDescriptiveStatsData()[column]?.['50%']) }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="std">
                      <th mat-header-cell *matHeaderCellDef>Std Dev</th>
                      <td mat-cell *matCellDef="let column">{{ formatNumber(getDescriptiveStatsData()[column]?.std) }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="min">
                      <th mat-header-cell *matHeaderCellDef>Min</th>
                      <td mat-cell *matCellDef="let column">{{ formatNumber(getDescriptiveStatsData()[column]?.min) }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="q25">
                      <th mat-header-cell *matHeaderCellDef>Q1 (25%)</th>
                      <td mat-cell *matCellDef="let column">{{ formatNumber(getDescriptiveStatsData()[column]?.['25%']) }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="q75">
                      <th mat-header-cell *matHeaderCellDef>Q3 (75%)</th>
                      <td mat-cell *matCellDef="let column">{{ formatNumber(getDescriptiveStatsData()[column]?.['75%']) }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="max">
                      <th mat-header-cell *matHeaderCellDef>Max</th>
                      <td mat-cell *matCellDef="let column">{{ formatNumber(getDescriptiveStatsData()[column]?.max) }}</td>
                    </ng-container>
                    
                    <tr mat-header-row *matHeaderRowDef="['column', 'count', 'mean', 'median', 'std', 'min', 'q25', 'q75', 'max']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['column', 'count', 'mean', 'median', 'std', 'min', 'q25', 'q75', 'max']"></tr>
                  </table>
                </div>

                <!-- Advanced Metrics with Enhanced Layout -->
                <div class="additional-stats" *ngIf="getAdditionalStatsData() && getObjectKeys(getAdditionalStatsData()).length > 0">
                  <h4>
                    <mat-icon>analytics</mat-icon>
                    Advanced Statistical Metrics
                  </h4>
                  <div class="advanced-metrics-grid">
                    <div *ngFor="let column of getDescriptiveStatsKeys()" class="metric-card">
                      <h5>{{ column }}</h5>
                      <div class="metric-row">
                        <span class="metric-label">Variance</span>
                        <span class="metric-value">{{ formatNumber(getAdditionalStatsData()[column]?.variance) }}</span>
                      </div>
                      <div class="metric-row">
                        <span class="metric-label">Coefficient of Variation</span>
                        <span class="metric-value">{{ formatNumber(getAdditionalStatsData()[column]?.coefficient_of_variation) }}</span>
                      </div>
                      <div class="metric-row">
                        <span class="metric-label">Range</span>
                        <span class="metric-value">{{ formatNumber(getAdditionalStatsData()[column]?.range) }}</span>
                      </div>
                      <div class="metric-row">
                        <span class="metric-label">Interquartile Range (IQR)</span>
                        <span class="metric-value">{{ calculateIQR(column) }}</span>
                      </div>
                      <div class="metric-row">
                        <span class="metric-label">Skewness</span>
                        <span class="metric-value">{{ getSkewnessLabel(column) }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Correlation Analysis -->
          <mat-card *ngIf="basicResults.correlation_matrix" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>device_hub</mat-icon>
                Correlation Analysis & Relationship Insights
              </mat-card-title>
              <mat-card-subtitle>
                Discover relationships between variables with AI-powered insights and interactive visualizations
              </mat-card-subtitle>
            </mat-card-header>
            
            <mat-card-content>
              <!-- AI-Driven Correlation Insights -->
              <div class="correlation-insights" *ngIf="getCorrelationInsights().length > 0">
                <h3 class="insights-title">
                  <mat-icon>psychology</mat-icon>
                  Relationship Intelligence
                </h3>
                
                <div class="insights-grid">
                  <div *ngFor="let insight of getCorrelationInsights()" class="insight-card">
                    <div class="insight-header">
                      <mat-icon [ngClass]="'insight-icon-' + insight.color">{{ insight.icon }}</mat-icon>
                      <h4>{{ insight.title }}</h4>
                    </div>
                    <p class="insight-description">{{ insight.description }}</p>
                  </div>
                </div>
              </div>

              <!-- Correlation Heatmap Visualization -->
              <div class="heatmap-section" *ngIf="getHeatmapVariables().length > 0">
                <h3 class="section-title">
                  <mat-icon>grid_on</mat-icon>
                  Correlation Heatmap
                </h3>
                
                <div class="heatmap-container">
                  <div class="heatmap-grid" 
                       [style.grid-template-columns]="'auto repeat(' + getHeatmapVariables().length + ', 1fr)'">
                    <!-- Empty corner cell -->
                    <div class="heatmap-corner"></div>
                    
                    <!-- Column Headers -->
                    <div class="heatmap-header" *ngFor="let variable of getHeatmapVariables()">
                      {{ variable }}
                    </div>
                    
                    <!-- Row Headers and Heatmap Cells -->
                    <ng-container *ngFor="let rowVar of getHeatmapVariables()">
                      <!-- Row Header -->
                      <div class="heatmap-row-header">{{ rowVar }}</div>
                      
                      <!-- Correlation Cells for this row -->
                      <div *ngFor="let colVar of getHeatmapVariables()" 
                           class="heatmap-cell"
                           [style.background-color]="getHeatmapColor(rowVar, colVar)"
                           [title]="rowVar + ' vs ' + colVar + ': ' + formatNumber(getCorrelationValue(rowVar, colVar))">
                        <span class="cell-value">{{ formatNumber(getCorrelationValue(rowVar, colVar)) }}</span>
                      </div>
                    </ng-container>
                  </div>
                  
                  <!-- Heatmap Legend -->
                  <div class="heatmap-legend">
                    <div class="legend-item">
                      <div class="legend-color" style="background: #ff6600;"></div>
                      <span>Strong Negative (-1.0 to -0.7)</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color" style="background: #ffb74d;"></div>
                      <span>Weak Negative (-0.7 to 0)</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color" style="background: #c8e6c9;"></div>
                      <span>Weak Positive (0 to 0.7)</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-color" style="background: #00ff88;"></div>
                      <span>Strong Positive (0.7 to 1.0)</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Interactive Correlation Matrix -->
              <div class="correlation-matrix-section" *ngIf="getCorrelationMatrixEntries().length > 0">
                <h3 class="section-title">
                  <mat-icon>table_chart</mat-icon>
                  Detailed Correlation Matrix
                </h3>
                
                <div class="matrix-table-container">
                  <table mat-table [dataSource]="getCorrelationMatrixEntries()" class="correlation-table">
                    <ng-container matColumnDef="variables">
                      <th mat-header-cell *matHeaderCellDef>Variable Pair</th>
                      <td mat-cell *matCellDef="let element">
                        <div class="variable-pair">
                          <strong>{{ element.var1 }}</strong>
                          <mat-icon>arrow_right_alt</mat-icon>
                          <strong>{{ element.var2 }}</strong>
                        </div>
                      </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="correlation">
                      <th mat-header-cell *matHeaderCellDef>Correlation</th>
                      <td mat-cell *matCellDef="let element">
                        <div class="correlation-value" 
                             [ngClass]="{'positive': element.correlation > 0, 'negative': element.correlation < 0}">
                          {{ formatNumber(element.correlation) }}
                        </div>
                      </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="strength">
                      <th mat-header-cell *matHeaderCellDef>Strength</th>
                      <td mat-cell *matCellDef="let element">
                        <mat-chip [color]="element.strength === 'Very Strong' || element.strength === 'Strong' ? 'warn' : 'primary'">
                          {{ element.strength }}
                        </mat-chip>
                      </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="interpretation">
                      <th mat-header-cell *matHeaderCellDef>Business Interpretation</th>
                      <td mat-cell *matCellDef="let element">
                        <div class="interpretation-text">
                          {{ element.interpretation }}
                        </div>
                      </td>
                    </ng-container>
                    
                    <tr mat-header-row *matHeaderRowDef="['variables', 'correlation', 'strength', 'interpretation']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['variables', 'correlation', 'strength', 'interpretation']"></tr>
                  </table>
                </div>
              </div>

              <!-- Strong Correlations Summary -->
              <div class="strong-correlations-section" *ngIf="getCorrelationPairs().length > 0">
                <h3 class="section-title">
                  <mat-icon>link</mat-icon>
                  Key Relationships (|r| ≥ 0.7)
                </h3>
                
                <div class="strong-correlations-grid">
                  <div *ngFor="let pair of getCorrelationPairs()" class="correlation-card">
                    <div class="correlation-header">
                      <div class="variable-names">
                        <span class="var1">{{ pair.var1 }}</span>
                        <mat-icon>{{ pair.correlation > 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
                        <span class="var2">{{ pair.var2 }}</span>
                      </div>
                      <div class="correlation-badge" 
                           [ngClass]="{'positive': pair.correlation > 0, 'negative': pair.correlation < 0}">
                        {{ formatNumber(pair.correlation) }}
                      </div>
                    </div>
                    
                    <div class="correlation-description">
                      <p><strong>{{ pair.strength | titlecase }}</strong> correlation indicates:</p>
                      <ul>
                        <li *ngIf="pair.correlation > 0">These variables move together in the same direction</li>
                        <li *ngIf="pair.correlation < 0">These variables move in opposite directions</li>
                        <li>{{ (abs(pair.correlation) * 100).toFixed(1) }}% of variation is shared</li>
                        <li *ngIf="abs(pair.correlation) > 0.8">Consider potential multicollinearity</li>
                        <li *ngIf="abs(pair.correlation) > 0.7 && abs(pair.correlation) <= 0.8">Strong predictive relationship</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <!-- No Strong Correlations Message -->
              <div class="no-correlations" *ngIf="getCorrelationPairs().length === 0 && getCorrelationMatrixEntries().length > 0">
                <div class="info-card">
                  <mat-icon>info</mat-icon>
                  <div class="info-content">
                    <h4>No Strong Correlations Detected</h4>
                    <p>All correlations are below 0.7, indicating that variables are relatively independent. This suggests:</p>
                    <ul>
                      <li>Good feature diversity for machine learning models</li>
                      <li>Lower risk of multicollinearity</li>
                      <li>Each variable contributes unique information</li>
                    </ul>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Distribution Analysis with Visualizations -->
          <mat-card *ngIf="basicResults.distribution_analysis" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>show_chart</mat-icon>
                Data Distribution Analysis & Visualizations
              </mat-card-title>
              <mat-card-subtitle>
                Statistical distribution patterns and visual analysis for each numeric column
              </mat-card-subtitle>
            </mat-card-header>
            
            <mat-card-content>
              <div class="distribution-content">
                <!-- AI-Driven Distribution Insights -->
                <div class="insights-section" *ngIf="getDistributionInsights().length > 0">
                  <h3 class="insights-title">
                    <mat-icon>psychology</mat-icon>
                    Distribution Intelligence
                  </h3>
                  
                  <div class="insights-grid">
                    <div *ngFor="let insight of getDistributionInsights()" class="insight-card">
                      <div class="insight-header">
                        <mat-icon [ngClass]="'insight-icon-' + insight.color">{{ insight.icon }}</mat-icon>
                        <h4>{{ insight.title }}</h4>
                      </div>
                      <p class="insight-description">{{ insight.description }}</p>
                    </div>
                  </div>
                </div>

                <!-- Visual Distribution Cards -->
                <div class="distribution-grid">
                  <div *ngFor="let column of getNumericColumns()" class="distribution-card">
                    <h4>
                      <mat-icon>bar_chart</mat-icon>
                      {{ column }} Distribution
                    </h4>
                    
                    <!-- Simple Text-based Histogram -->
                    <div class="distribution-chart">
                      <div class="text-histogram">
                        <div class="histogram-title">Distribution Pattern</div>
                        <div class="histogram-bars">
                          <div *ngFor="let bar of getTextHistogram(column)" 
                               class="histogram-bar"
                               [style.height.%]="bar.height"
                               [title]="'Range: ' + bar.range + ', Count: ' + bar.count">
                            <div class="bar-fill" [style.height.%]="bar.height"></div>
                            <div class="bar-label">{{ bar.range }}</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Distribution Statistics -->
                    <div class="distribution-stats">
                      <div class="stat-row">
                        <span class="stat-label">Shape</span>
                        <span class="stat-value">{{ getDistributionShape(column) }}</span>
                      </div>
                      <div class="stat-row">
                        <span class="stat-label">Symmetry</span>
                        <span class="stat-value">{{ getDistributionSymmetry(column) }}</span>
                      </div>
                      <div class="stat-row">
                        <span class="stat-label">Outlier Risk</span>
                        <span class="stat-value">{{ getOutlierRisk(column) }}</span>
                      </div>
                      <div class="stat-row">
                        <span class="stat-label">Data Quality</span>
                        <span class="stat-value">{{ getDataQuality(column) }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Technical Distribution Details -->
                <div class="technical-section">
                  <h3 class="technical-title">
                    <mat-icon>code</mat-icon>
                    Technical Distribution Details
                  </h3>
                  <pre>{{ formatDistributionData(basicResults.distribution_analysis) }}</pre>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Missing Data Analysis -->
          <mat-card *ngIf="basicResults.missing_data_summary" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>error_outline</mat-icon>
                Missing Data Analysis
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="missing-data-content">
                <pre>{{ basicResults.missing_data_summary | json }}</pre>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Advanced Statistics Tab -->
    <mat-tab label="Advanced Statistics">
      <div class="tab-content">
        <!-- Options Selection -->
        <mat-card class="options-card">
          <mat-card-header>
            <mat-card-title>Advanced Analysis Options</mat-card-title>
            <mat-card-subtitle>Select advanced statistical and ML analyses</mat-card-subtitle>
          </mat-card-header>
          
          <mat-card-content>
            <div class="options-grid">
              <mat-checkbox 
                *ngFor="let option of advancedOptions" 
                [(ngModel)]="option.selected"
                class="option-checkbox">
                <div class="option-content">
                  <span class="option-name">{{ option.name }}</span>
                  <span class="option-description">{{ option.description }}</span>
                </div>
              </mat-checkbox>
            </div>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-raised-button 
                    color="accent" 
                    (click)="calculateAdvancedStatistics()"
                    [disabled]="isLoading">
              <mat-icon>science</mat-icon>
              Calculate Advanced Statistics
            </button>
            
            <mat-spinner *ngIf="isLoading" diameter="24" class="inline-spinner"></mat-spinner>
          </mat-card-actions>
        </mat-card>

        <!-- Advanced Results -->
        <div class="results-section" *ngIf="advancedResults">
          <!-- Regression Analysis -->
          <mat-card *ngIf="advancedResults.regression_analysis" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>trending_up</mat-icon>
                Regression Analysis
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="regression-content">
                <div class="metrics-grid" *ngIf="advancedResults.regression_analysis.metrics">
                  <div class="metric-item">
                    <span class="metric-label">R² Score</span>
                    <span class="metric-value">{{ formatNumber(advancedResults.regression_analysis.metrics.r2_score) }}</span>
                  </div>
                  <div class="metric-item">
                    <span class="metric-label">Mean Squared Error</span>
                    <span class="metric-value">{{ formatNumber(advancedResults.regression_analysis.metrics.mse) }}</span>
                  </div>
                  <div class="metric-item">
                    <span class="metric-label">Mean Absolute Error</span>
                    <span class="metric-value">{{ formatNumber(advancedResults.regression_analysis.metrics.mae) }}</span>
                  </div>
                </div>
                <div class="feature-importance" *ngIf="advancedResults.regression_analysis.feature_importance">
                  <h4>Feature Importance</h4>
                  <div class="importance-list">
                    <div class="importance-item" *ngFor="let item of getFeatureImportanceEntries()">
                      <span class="feature-name">{{ item.key }}</span>
                      <div class="importance-bar">
                        <div class="importance-fill" [style.width.%]="(item.value * 100)"></div>
                      </div>
                      <span class="importance-value">{{ formatNumber(item.value) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Clustering Results -->
          <mat-card *ngIf="advancedResults.clustering_results" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>scatter_plot</mat-icon>
                Clustering Analysis
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="clustering-content">
                <div class="cluster-summary" *ngIf="advancedResults.clustering_results.summary">
                  <p><strong>Number of Clusters:</strong> {{ advancedResults.clustering_results.summary.n_clusters }}</p>
                  <p><strong>Silhouette Score:</strong> {{ formatNumber(advancedResults.clustering_results.summary.silhouette_score) }}</p>
                  <p><strong>Inertia:</strong> {{ formatNumber(advancedResults.clustering_results.summary.inertia) }}</p>
                </div>
                <div class="cluster-details" *ngIf="advancedResults.clustering_results.cluster_centers">
                  <h4>Cluster Centers</h4>
                  <pre>{{ advancedResults.clustering_results.cluster_centers | json }}</pre>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- PCA Analysis -->
          <mat-card *ngIf="advancedResults.pca_analysis" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>compress</mat-icon>
                Principal Component Analysis
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="pca-content">
                <div class="pca-summary" *ngIf="advancedResults.pca_analysis.explained_variance_ratio">
                  <h4>Explained Variance by Component</h4>
                  <div class="variance-list">
                    <div class="variance-item" *ngFor="let variance of advancedResults.pca_analysis.explained_variance_ratio; let i = index">
                      <span class="component-label">PC{{ i + 1 }}</span>
                      <div class="variance-bar">
                        <div class="variance-fill" [style.width.%]="(variance * 100)"></div>
                      </div>
                      <span class="variance-value">{{ (variance * 100).toFixed(2) }}%</span>
                    </div>
                  </div>
                </div>
                <div class="cumulative-variance" *ngIf="advancedResults.pca_analysis.cumulative_variance">
                  <p><strong>Total Variance Explained:</strong> {{ (advancedResults.pca_analysis.cumulative_variance * 100).toFixed(2) }}%</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Time Series Analysis -->
          <mat-card *ngIf="advancedResults.time_series_analysis" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>timeline</mat-icon>
                Time Series Analysis
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="timeseries-content">
                <pre>{{ advancedResults.time_series_analysis | json }}</pre>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Anomaly Detection -->
          <mat-card *ngIf="advancedResults.anomaly_detection" class="result-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>warning</mat-icon>
                Anomaly Detection
              </mat-card-title>
            </mat-card-header>
            
            <mat-card-content>
              <div class="anomaly-content">
                <div class="anomaly-summary" *ngIf="advancedResults.anomaly_detection.summary">
                  <p><strong>Anomalies Detected:</strong> {{ advancedResults.anomaly_detection.summary.n_anomalies }}</p>
                  <p><strong>Anomaly Rate:</strong> {{ (advancedResults.anomaly_detection.summary.anomaly_rate * 100).toFixed(2) }}%</p>
                </div>
                <div class="anomaly-details" *ngIf="advancedResults.anomaly_detection.anomaly_indices">
                  <h4>Anomalous Records (indices)</h4>
                  <mat-chip-set>
                    <mat-chip *ngFor="let index of advancedResults.anomaly_detection.anomaly_indices.slice(0, 10)">
                      {{ index }}
                    </mat-chip>
                    <mat-chip *ngIf="advancedResults.anomaly_detection.anomaly_indices.length > 10">
                      +{{ advancedResults.anomaly_detection.anomaly_indices.length - 10 }} more
                    </mat-chip>
                  </mat-chip-set>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<!-- No Dataset Message -->
<div class="no-dataset" *ngIf="!currentDataset">
  <mat-card>
    <mat-card-content>
      <div class="no-dataset-content">
        <mat-icon class="no-dataset-icon">upload_file</mat-icon>
        <h2>No Dataset Selected</h2>
        <p>Please upload a dataset first to perform statistical analysis.</p>
        <button mat-raised-button color="primary" routerLink="/upload">
          <mat-icon>upload</mat-icon>
          Upload Dataset
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
