<div
  class="metric-card-wrapper"
  [class.mobile]="isMobile"
  role="button"
  [attr.aria-label]="title + ' summary'"
>
  <div class="metric-card" [class.premium]="!isMobile">
    <!-- Card Icon/Category Indicator -->
    <div class="card-icon" [ngClass]="getCardCategory()">
      <mat-icon>{{ getCardIcon() }}</mat-icon>
    </div>

    <ng-container *ngIf="!isMobile; else mobileView">
      <!-- Enhanced Desktop View -->
      <div class="card-header">
        <div class="title-section">
          <div class="title-row">
            <h3 class="title">{{ title }}</h3>
          </div>
          <p class="subtitle">{{ subtitle }}</p>
        </div>
      </div>

      <div class="card-body">
        <div class="main-metric">
          <div class="primary-value">
            <span class="value">{{ value !== null ? (value | number) : '-' }}</span>
            <div class="trend-section" *ngIf="changePercent !== null && changePercent !== undefined && yesterdayValue !== null && yesterdayValue !== undefined">
              <div class="trend-indicator-compact" [ngClass]="trendClass">
                <mat-icon class="trend-icon">{{ trendIcon }}</mat-icon>
                <span class="trend-text">{{ changeSign }}{{ changePercent | number:'1.1-1' }}%</span>
              </div>
            </div>
          </div>
          
          <div class="comparison-section" *ngIf="yesterdayValue !== null && yesterdayValue !== undefined">
            <div class="comparison-row">
              <span class="label">vs yesterday</span>
              <span class="prev-value">{{ yesterdayValue | number }}</span>
            </div>
            <div class="change-row" *ngIf="changeAmount !== null && changeAmount !== undefined">
              <span class="change-amount" [ngClass]="trendClass">{{ formattedChangeAmount }}</span>
            </div>
          </div>
        </div>

        <!-- Mini Chart/Sparkline - Hidden on dashboard, shown on click/detail view -->
        <!-- <div class="chart-section" *ngIf="sparkline?.length">
          <canvas
            baseChart
            [data]="sparklineChartData"
            [options]="sparklineOptions"
            [type]="'line'"
            class="sparkline-chart"
          ></canvas>
        </div> -->
      </div>

      <div class="card-footer">
        <div class="insights">
          <div class="insight-pill" *ngIf="averagePerHour !== null">
            <mat-icon>schedule</mat-icon>
            <span>{{ averagePerHour | number }}/hr avg</span>
          </div>
          <div class="insight-pill" *ngIf="peakTime">
            <mat-icon>timeline</mat-icon>
            <span>Peak: {{ peakTime }}</span>
          </div>
        </div>
        <div class="last-updated" *ngIf="lastUpdated">
          <mat-icon>access_time</mat-icon>
          <span>{{ lastUpdated }}</span>
        </div>
      </div>
    </ng-container>

    <ng-template #mobileView>
      <!-- Enhanced Mobile View -->
      <div class="mobile-card">
        <div class="mobile-header">
          <div class="title-row">
            <h4 class="mobile-title">{{ title }}</h4>
            <mat-icon class="chevron">chevron_right</mat-icon>
          </div>
          <div class="trend-badge" [ngClass]="trendClass" *ngIf="changePercent !== null && changePercent !== undefined">
            <mat-icon>{{ trendIcon }}</mat-icon>
            <span>{{ changeSign }}{{ changePercent | number:'1.1-1' }}%</span>
          </div>
        </div>

        <div class="mobile-body">
          <div class="main-value">{{ value !== null ? (value | number) : '-' }}</div>
          <div class="mobile-subtitle">{{ subtitle }}</div>
          <div class="mobile-comparison" *ngIf="yesterdayValue !== null && yesterdayValue !== undefined">
            <span class="comparison-text">vs {{ yesterdayValue | number }}</span>
            <span class="change-text" [ngClass]="trendClass" *ngIf="changeAmount !== null && changeAmount !== undefined">
              ({{ formattedChangeAmount }})
            </span>
          </div>
        </div>

        <div class="mobile-footer" *ngIf="lastUpdated">
          <div class="status-dot" [ngClass]="trendClass"></div>
          <span class="update-text">Updated {{ lastUpdated }}</span>
        </div>
      </div>
    </ng-template>

    <!-- Gradient Border Effect -->
    <div class="border-gradient"></div>
  </div>
</div>